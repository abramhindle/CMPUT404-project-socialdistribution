{% load static %}
<!doctype html>
<!DOCTYPE html>
<html>
<head>
	<title>Squawk | Explore</title>
	<meta charset="UTF-8">
	<meta name="description" content="Explore">
	<meta name="author" content="CMPUT404 Group">

	<!-- stylesheets / css -->
	<link rel="stylesheet" href="{% static '../../static/sd/style.css' %}">
	<script type="text/javascript" src="{% static '../../static/sd/helperfunctions.js' %}"></script>
	<script src="https://code.jquery.com/jquery-1.10.2.js"></script>
</head>

<script type="text/javascript">
function loadBar() {
	$("#navbar").load("static/sd/navbar.html");
	$("#header").load("static/sd/header.html");
}
</script>
<script type="text/javascript">
function get_all_posts(){
	fetch('http://127.0.0.1:8000/author/posts')
	.then(
    function(response) {
      if (response.status !== 200) {
        console.log('Looks like there was a problem. Status Code: ' +
          response.status);
        return;
      }
      // Examine the text in the response
      response.json().then(function(data) {
		console.log(data);
		var element = document.getElementById('posts');
		for (item of data){
			var node = document.createElement('div');
			var author = document.createTextNode(item.author)
			var textnode = document.createTextNode(item.body);
			node.appendChild(author)
			node.appendChild(textnode)
			element.appendChild(node);
		}
      });
    }
  )
  .catch(function(err) {
    console.log('Fetch Error :-S', err);
  });
 
}
</script>

<body onload="loadBar(); get_all_posts()">
	<div class="header" id="header">
	</div>

	<div class = "row">
		<div class="navbar" id="navbar">

		</div>

		<div class = "feed">

			<div id="posts">
				It's {{authenticated}}, {{current_user }} is logged in
			</div>

			{% if messages %}
			<div class="feeditem">
				{{ messages }}
			</div>
			{% endif %}

			{% if messages %}
			<div class="feeditem">
				{{ messages }}
			</div>
			{% endif %}

			{% for post in feed %}
			
			{% if post.status == 'pub' and post.author != current_user %}
			<!-- check if I am the author, my posts should not show up in the explore page -->
            <div class="feeditem">
                <div id = "author"> {{post.author}} </div>
                <div id = "date"> {{post.published}} <br> <br> </div>
                <div id = "title">{{post.title}} <br> <br> </div>
                <a href = "{{post.link_to_image}}">
                	<img class = "feedimage" src = "{{post.link_to_image}}" alt = "Link to Image">
                </a>
                <div id = "postBody">{{post.content}} <br> <br> <br> </div>
                <a>
                	<span id = "commentsifyesButton" onclick ="displayCommentsCheck('show-comments-{{post}}');"> Comments <br><br> </span>
          		</a>

                <div id = "show-comments-{{post}}" style = "display: none;">
                	{% for post_comment in feed %}
                		<div class = "commentitem">
	                		<div id = "commentauthor"> {{post_comment.author}} </div>
	                		<div id = "commentdate"> {{post_comment.published}} <br> <br> </div>
	                		<div id = "commentbody"> {{post_comment.comment}} <br> </div>
	                	</div>
					{% endfor %}

					<form>
						<input name = "comment" type="text" id = "addcommentfield" placeholder = "Add a comment..."/>
						<input type = "submit" value = "SUBMIT" id = "submit-blue-button"/> <br>
					</form>
					<br>
				</div>
			</div>
			{% endif %}
			{% endfor %}
		</div>
	</div>
</body>
</html>
